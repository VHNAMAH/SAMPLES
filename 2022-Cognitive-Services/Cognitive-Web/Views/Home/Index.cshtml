@{
    ViewData["Title"] = "Home";
}

<div>
    <div class="text-center">
        <h1 class="display-4">Cognitive Booth</h1>
    </div>

    <div class="row mb-3">
        <div class="card">
            <div class="card-img-top d-flex align-items-center justify-content-center p-3">
                <div id="webcaminput"></div>
            </div>
            <!-- A button for taking snaps -->
            <div class="card-body d-flex justify-content-center">
                <form>
                    <input type="button" class="btn btn-success" value="Take Snapshot" onClick="take_snapshot()">
                </form>
            </div>
        </div>
    </div>
    <div id="results" class="row p-2">
        <p>Captured Images</p>
    </div>
</div>

<!-- Include the Webcam.js JavaScript Library -->
<script src="~/webcam/webcam.min.js"></script>

<script language="JavaScript">
    Webcam.set({
        width: 320,
        height: 240,
        image_format: 'jpeg',
        jpeg_quality: 90
    });
    Webcam.attach('#webcaminput');  
</script>
<!-- Code to handle taking the snapshot and displaying it locally -->
<script language="JavaScript">
    function take_snapshot() {
        // take snapshot and get image data  
        Webcam.snap(function (data_uri) {
            let now = Date.now();
            // display results in page  
            document.getElementById('results').innerHTML += `
            <div class="col-md-6 col-lg-4">
                <div class="card m-2 d-flex align-items-center justify-content-center">
                    <img class="card-img-top" src="${data_uri}" alt="webcam-capture">
                    <div id="${now}">
                        Awaiting Processing...
                    </div>
                </div>
                </div>
            `;

            Webcam.upload(data_uri,
                '/Camera/Capture',
                function (code, body) {
                    let result = JSON.parse(body);

                    document.getElementById(now).innerHTML = "";
                    for (let i = 0; i < result.length; i++) {
                        document.getElementById(now).innerHTML += `<div class="cs-tag"><span class="key">${result[i].key}</span><span class="value">${result[i].value.toFixed(2)*100}</span></div>`
                    }
                });

        });
    }  
</script>